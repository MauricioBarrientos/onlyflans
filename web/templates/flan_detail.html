{% extends "base.html" %}

{% block title %}{{ flan.name }} - OnlyFlans{% endblock %}

{% block content %}
<style>
    .flan-detail {
        max-width: 800px;
        margin: 2rem auto;
        padding: 2rem;
        background-color: #f8f9fa;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .flan-image {
        width: 100%;
        height: 400px;
        object-fit: cover;
        border-radius: 8px;
        margin-bottom: 2rem;
    }
    .flan-title {
        color: #343a40;
        margin-bottom: 1rem;
    }
    .flan-description {
        color: #6c757d;
        font-size: 1.1rem;
        line-height: 1.6;
        margin-bottom: 2rem;
    }
    .flan-price {
        font-size: 1.5rem;
        font-weight: bold;
        color: #28a745;
        margin-bottom: 2rem;
    }
    .reviews-section {
        margin-top: 3rem;
    }
    .review {
        background-color: var(--color-surface);
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    .review-rating {
        color: var(--color-primary);
    }
    .review-date {
        color: var(--color-text-secondary);
        font-size: 0.9rem;
    }
    .add-review-form {
        background-color: var(--color-surface);
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        margin-top: 2rem;
    }
    .add-review-form .form-group input,
    .add-review-form .form-group textarea {
        background-color: white !important;
        color: black !important;
        border: 1px solid var(--color-border);
        padding: 0.5rem;
        border-radius: 4px;
        width: 100%;
    }
</style>

<div class="flan-detail">
    <img src="{{ flan.image_url }}" alt="{{ flan.name }}" class="flan-image">
    <h1 class="flan-title">{{ flan.name }}</h1>
    <p class="flan-description">{{ flan.description }}</p>
    <p class="flan-price">${{ flan.price }}</p>

    <div class="reviews-section">
        <h2>Reseñas</h2>
        {% for review in reviews %}
            <div class="review">
                <div class="review-rating">
                    {% for i in "12345"|make_list %}
                        {% if forloop.counter <= review.rating %}
                            ★
                        {% else %}
                            ☆
                        {% endif %}
                    {% endfor %}
                </div>
                <p>{{ review.comment }}</p>
                <small class="review-date">Por {{ review.user.username }} el {{ review.created_at|date:"d/m/Y" }}</small>
            </div>
        {% empty %}
            <p>No hay reseñas aún.</p>
        {% endfor %}

        {% if user.is_authenticated %}
            <div class="add-review-form">
                <h3>Agregar reseña</h3>
                <form method="post">
                    {% csrf_token %}
                    {% for field in form %}
                        <div class="form-group">
                            {{ field.label_tag }}
                            {{ field }}
                            {% if field.errors %}
                                <small style="color: red;">{{ field.errors|striptags }}</small>
                            {% endif %}
                        </div>
                    {% endfor %}
                    <button type="submit" class="btn btn-primary">Enviar reseña</button>
                </form>
            </div>
        {% else %}
            <p><a href="{% url 'login' %}">Inicia sesión</a> para agregar una reseña.</p>
        {% endif %}
    </div>
</div>
{% endblock %}